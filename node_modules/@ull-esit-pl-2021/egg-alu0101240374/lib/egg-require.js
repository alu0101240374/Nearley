let readFile = require('fs').readFileSync;
let parser = require('./parse.js');
let parse = parser.parse;
const {Value, Word, Apply} = require('./ast.js');

let REQUIRE = {};
REQUIRE.cache = Object.create(null);
REQUIRE.fun = function(name, env) {
  name = name.evaluate();
  name = name.substring(1, name.length - 1);
  if (name in REQUIRE.cache)  
      return REQUIRE.cache[name];
  let code = function(name, env) {
    let tree = parse(readFile(name, 'utf-8'));
    return tree.evaluate(env);
  }
  let result = code(name, env)
  REQUIRE.cache[name] = result;
  return result;
}

module.exports = REQUIRE;